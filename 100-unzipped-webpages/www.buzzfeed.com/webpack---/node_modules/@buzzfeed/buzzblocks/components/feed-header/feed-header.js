import {
    Application
} from 't3js';

class FeedHeader {
    constructor(ctx) {
        this.el = ctx.getElement();
        this.img = this.el.querySelector('.js-feed-header-bg-image');
    }

    setBackgroundImage() {
        if (!this.img) {
            return;
        }

        const attributes = {
            desktopSrc: 'data-src',
            mobileSrc: 'data-mobile-src',
        };
        const desktopSrc = this.img.getAttribute(attributes.desktopSrc);
        const mobileSrc = this.img.getAttribute(attributes.mobileSrc);

        // if the window size is desktop width, use the bigger of the two images.
        // otherwise, use the mobile image (with desktop as a fallback in case there's no mobile option)
        const imgSrc = window.matchMedia('(min-width: 40rem)').matches ? desktopSrc : mobileSrc || desktopSrc;

        this.img.src = imgSrc;
    }

    init() {
        this.setBackgroundImage();
    }
}

Application.addModule(
    'feed-header',
    ctx => new FeedHeader(ctx)
);