import abeagle from '@buzzfeed/buzzblocks/js/services/abeagle';
import {
    Disabled
} from '../../../core/error';


const FEATURE_FLAG = 'ads_adomik';

let _initializing;


export default {
    init() {
        if (_initializing) {
            return _initializing;
        }

        return _initializing = abeagle.isOn(FEATURE_FLAG)
            .then((isOn) => isOn ? Promise.resolve(true) : Promise.reject(new Disabled()))
            .catch((err) => {
                if (!(err instanceof Disabled)) {
                    console.error(err);
                }
                return null;
            });
    },
    randomAdGroup() {
        var rand = Math.random();
        switch (false) {
            case !(rand < 0.09):
                return 'ad_ex' + (Math.floor(100 * rand));
            case !(rand < 0.10):
                return 'ad_bc';
            default:
                return 'ad_opt';
        }
    }

};