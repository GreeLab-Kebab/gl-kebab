import {
    loadScript
} from '@buzzfeed/bf-utils';
import abeagle from '@buzzfeed/buzzblocks/js/services/abeagle';


// namespace for easier testing
const util = {
    loadScript
};


const FEATURE_FLAG = 'ads_moat';

const MOAT_URL = 'https://z.moatads.com/buzzfeedprebidheader126112369715/moatheader.js';


const service = {
    /*
     * initialize moat if feature is on
     */
    init: () => {
        if (!service.initialized) {
            service.initialized = abeagle.isOn(FEATURE_FLAG)
                .then((isOn) => isOn ? util.loadScript(MOAT_URL) : null)
                .catch((error) => {
                    console.error(error);
                    return Promise.reject(error);
                });
        }
        return service.initialized;
    }
};

export default service;