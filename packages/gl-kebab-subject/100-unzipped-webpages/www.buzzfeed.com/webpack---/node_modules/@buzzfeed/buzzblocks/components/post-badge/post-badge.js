import {
    Application
} from 't3js';
import dom from '../../js/services/dom';
import util from '../../js/services/util';
import {
    name as viewable
} from '../../js/behaviors/viewable';

Application.addModule('post-badge', function(context) {
    'use strict';

    //-----------------------------------------------------------
    // Private
    //-----------------------------------------------------------

    var _eventHandlers = {};
    var _element = context.getElement();
    var _badge = dom.findOne(_element, '.js-post-badge');

    /**
     * Render module
     * @return {void}
     */
    function _render() {
        dom.addClass(_badge, 'post-badge__badge--visible');
        // add a11y properties
        if (_badge) {
            const _svg = _badge.querySelector('svg');
            const _title = _badge.querySelector('title');

            if (_title && _svg) {
                const id = `badge-${Math.random().toString(36).replace(/[^a-z1-9]+/g, '')}`;
                _svg.setAttribute('aria-labelledby', id);
                _title.setAttribute('id', id);
            }
        }
    }

    _eventHandlers[util.getUniqueEventName('viewport-active', _element)] = _render;

    //-----------------------------------------------------------
    // Public
    //-----------------------------------------------------------

    /**
     * Post Badge
     * @exports module:post-badge
     * @mixes behavior:viewable
     */
    var module = {};

    module.behaviors = [viewable];

    module.messages = util.getKeys(_eventHandlers);

    /**
     * Handles event subscriptions
     * @param {String} msg - event name.
     * @param {*} data - event data.
     * @listens viewport-active
     * @return {void}
     */
    module.onmessage = util.getMessageHandler(_eventHandlers);

    return module;
});