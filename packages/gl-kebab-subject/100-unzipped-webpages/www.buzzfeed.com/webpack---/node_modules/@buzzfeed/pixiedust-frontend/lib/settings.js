import isObject from 'lodash/isObject';
import extend from 'lodash/extend';

// dev by default
var env = 'dev';

var userSettings = {};

var environmentSettings = {
    'dev': {
        'trackingURL': 'https://nsq-api-public.dev.buzzfeed.io',
        'debug': true
    },
    'stage': {
        'trackingURL': 'https://pixiedust-stage.buzzfeed.com',
        'debug': true
    },
    'prod': {
        'trackingURL': 'https://pixiedust.buzzfeed.com',
        'debug': false
    },
    'app-west': {
        'trackingURL': 'https://pixiedust.buzzfeed.com',
        'debug': false
    }
};

// support non-rig environments that use "live" to designate production
environmentSettings.live = environmentSettings.prod;

var defaultSettings = {
    'apiVersion': '1',
    'delay': 200,
    'urlLengthLimit': 2000,
    'batch': true,
    'samplingRate': 0,
    'requiredFields': ['type', 'source', 'session_id'],
    'acceptedDataTypes': ['string', 'boolean', 'number']
};

/**
 * get() is used to get a particular setting given the environment passed in
 * to init()
 *
 * @param {String} key
 * @return {String|Int|Boolean}
 */
function get(key) {
    if (key in userSettings && userSettings[key] !== undefined) {
        return userSettings[key];
    }

    var envSettings = environmentSettings[env];
    if (envSettings && key in envSettings) {
        return envSettings[key];
    }

    return defaultSettings[key];
}

/**
 * set() is used within Pixiedust to specify settings. It takes a key and a
 * value or an object of key:value pairs.
 *
 * @param {Object|String} key
 * @param {String|Int|Boolean} val
 */
function set(key, val) {
    var attrs = {};
    if (isObject(key)) {
        attrs = key;
    } else {
        attrs[key] = val;
    }

    extend(userSettings, attrs);
}

/**
 * init() is used to set the environment (which is 'dev' by default)
 * Acceptable environments are 'dev', 'stage', and 'live'. Logs a warning
 * in the console if the environment string is not recognized.
 *
 * @param {String} environment
 */
function init(environment) {
    if (!environmentSettings[environment]) {
        console.warn('Pixiedust: environment not recognized:', environment);
        return;
    }
    env = environment;
}

export default {
    init: init,
    get: get,
    set: set
};